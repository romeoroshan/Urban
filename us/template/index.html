{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">

    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

    <script>
        var count = 0;

    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        #search-results{
            position: fixed;
            background-color: white;
            z-index: 1;
            top: 75px;
        }
        #notification-results{
            position: fixed;
            background-color: white;
            z-index: 1;
            top: 75px;
        }
        .search-container {
        position: relative;
        width: 50%;
        margin-left: 3px;
    }

    /* Style for the user list container */
    .user-list {
        position: absolute;
        top: 100%;
        left: 0;
        width: 100%;
        max-height: 200px; /* Set a maximum height for the list */
        overflow-y: auto; /* Enable vertical scrolling */
        background-color: #fff;
        border: 1px solid #ccc;
        border-top: none;
        display: none; /* Hide by default */
    }

    /* Style for each user box */
    .user-box {
        display: flex;
        align-items: center;
        border-bottom: 1px solid #ccc;
        padding: 10px;
    }

    /* Style for user image */
    .user-img {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        margin-right: 10px;
    }

    /* Style for user name */
    .user-name {
        font-weight: bold;
    }
    .notification-badge {
  position: absolute;
  top: 15;
  right: 50;
  background-color: red;
  color: white;
  font-size: 12px;
  padding: 2px 6px;
  border-radius: 50%;
}

    @media (max-width: 991.98px) {
        #search-results{
            position: fixed;
            background-color: white;
            z-index: 1;
            top: 125px;
        }
        #notification-results{
            position: fixed;
            background-color: white;
            z-index: 1;
            top: 125px;
        }

}
    </style>
    <link rel="stylesheet" href="{% static 'style.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script type="text/javascript" src="{% static 'ajax.js' %}"></script>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        google.charts.load("current", { packages: ["corechart"] });
        google.charts.setOnLoadCallback(drawChart);
        function drawChart() {
            var count = parseInt('{{ count }}');
            console.log(count);

            var player = parseInt('{{ player }}');
            console.log(player);

            var playerPercentage = (player / count) * 100;
            var totalPercentage = 100 - playerPercentage;

            var data = google.visualization.arrayToDataTable([
                ['Task', 'Percentage'],
                ['', playerPercentage],
                ['', totalPercentage],
            ]);

            var options = {
                is3D: true,
                legend: 'none',
                pieSliceText: 'none',
            };

            var chart = new google.visualization.PieChart(document.getElementById('piechart_player_3d'));
            chart.draw(data, options);
        }
    </script>
    <script type="text/javascript">
        google.charts.load("current", { packages: ["corechart"] });
        google.charts.setOnLoadCallback(drawChart);
        function drawChart() {
            var count = parseInt('{{ count }}');
            console.log(count);

            var player = parseInt('{{ club }}');
            console.log(player);

            var playerPercentage = (player / count) * 100;
            var totalPercentage = 100 - playerPercentage;

            var data = google.visualization.arrayToDataTable([
                ['Task', 'Percentage'],
                ['', playerPercentage],
                ['', totalPercentage],
            ]);

            var options = {
                is3D: true,
                legend: 'none',
                pieSliceText: 'none',
            };

            var chart = new google.visualization.PieChart(document.getElementById('piechart_club_3d'));
            chart.draw(data, options);
        }
    </script>

</head>
<form action="POST">
    {% csrf_token %}
</form>
<body class="bg-light">
    {% if user.is_superuser %}
    <nav class="navbar player-navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="ms-5 navbar-brand d-flex fs-2 fw-bold" href="#">
                <p class="text-white">Urban</p>
                <p class="text-warning">Scout</p>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <div class="ms-3 d-flex w-75">
                    <input type="text" class="form-control" id="search_bar" placeholder="Search">
                    <button class="btn shadow-none"><i class="bi bi-search fs-3 text-white"></i></button>
                </div>
                <div id="search-results" class="col-lg-3 col-11 rounded shadow-lg">
                    <!-- Results will be displayed here -->
                </div>
                <div class="ms-3">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link  text-white" aria-current="page" href="{% url 'index' %}">Manage
                                Users</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-secondary" aria-current="page"
                                href="{% url 'RegisterScout' %}">Register Scouts</a>
                        </li>
                        

                    </ul>
                </div>
                <div class="d-flex w-100 justify-content-start justify-content-sm-end">
                    
                    
                    
                    <div class="border rounded p-2 pb-0 mt-2 ms-3">
                        <p class="text-light "><i class="bi bi-person-circle"></i> Admin</p>
                    </div>
                    <div class="d-flex justify-content-center flex-column">
                        <a class="d-flex flex-column justify-content-center text-decoration-none"
                            href="{% url 'logout' %}"><button class="btn text-white ms-4">Log-out</button></a>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    <div class="d-flex justify-content-center">
        <div class="bg-white shadow-lg mt-4 pb-3 rounded col-12 col-lg-8">
            <p class="m-4 text-secondary fs-4 fw-bold">Manage Users</p>

            <div class="d-flex justify-content-center flex-lg-row align-items-center text-center flex-column">
                <div class="d-flex col-3 justify-content-center flex-column align-items-center">
                    <p class="fs-5 text-secondary">Number of Users</p>
                    <p class="fs-4">{{count}}</p>
                </div>
                <div class="d-flex col-3 justify-content-center flex-column align-items-center">
                    <p class="fs-5 text-secondary">Number of Players</p>
                    <p class="fs-4">{{player}}</p>
                    <div id="piechart_player_3d" style="width: 240px; height: 240px;"></div>
                </div>
                <div class="d-flex col-3 justify-content-center flex-column align-items-center">
                    <p class="fs-5 text-secondary">Number of Clubs</p>
                    <p class="fs-4">{{club}}</p>
                    <div id="piechart_club_3d" style="width: 240px; height: 240px;"></div>
                </div>
            </div>
            <div class="table-responsive m-2">
                <table id="userbox" class="table rounded text-center table-hover table-bordered">
                    <thead class="fw-bold">
                        <tr>
                            <th>Email</th>
                            <th>User Role</th>
                            <th>Status</th>
                            <th>Edit Status</th>
                            <th>Delete User</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for i in users %}
                        {% if not i.is_staff %}
                        <tr id="user-{{i.id}}">
                            <td>{{i.email}}</td>
                            <td>
                                {% if i.is_player %}
                                Player
                                {% elif i.is_club %}
                                Club
                                {% else %}
                                Scout
                                {% endif %}
                            </td>
                            <td>{{i.is_active}}</td>
                            <td><a href="{% url 'updateStatus' i.id %}"><button class="btn btn-primary"><i
                                            class="bi bi-pencil-square"></i></button></a></td>
                            <td><a href="{% url 'deleteUser' i.id %}"><button class="btn btn-danger delete-button"><i
                                        class="bi bi-trash3-fill"></i></button></a></td>
                        </tr>
                        {% endif %}
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            <script>
                $(document).ready(function () {
                    new DataTable('#userbox');
                    
                    // Set a placeholder for the search input
                    $('div.dataTables_wrapper div.dataTables_filter input').attr('placeholder', 'Search anything');
                });
            </script>
            
            

        </div>
    </div>
    {% elif user.is_club %}
    <nav class="navbar player-navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="ms-5 navbar-brand d-flex fs-2 fw-bold" href="#">
                <p class="text-white">Urban</p>
                <p class="text-warning">Scout</p>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <div class="ms-3 d-flex w-75">
                    <input type="text" class="form-control" id="search_bar" placeholder="Search">
                    <button class="btn shadow-none"><i class="bi bi-search fs-3 text-white"></i></button>
                </div>
                <div id="search-results" class="col-lg-3 col-11 rounded shadow-lg">
                    <!-- Results will be displayed here -->
                </div>
                <div class="ms-3">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link  text-white" aria-current="page" href="{% url 'index' %}">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-secondary" aria-current="page" href="{% url 'ClubScout' %}">Scouts</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-secondary" aria-current="page"
                                href="{% url 'ClubPlayer' %}">Players</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-secondary" aria-current="page"
                                href="{% url 'following_feeds' %}">Feeds</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-secondary" aria-current="page"
                                href="{% url 'tournaments' %}">Tournaments</a>
                        </li>
                    </ul>
                </div>
                <div class="d-flex w-100 justify-content-start justify-content-sm-end">
                    <div class="d-flex flex-column justify-content-center">
                    <a href="{% url 'payment' %}"><button class="btn"><i class="bi bi-pen-fill text-white  fs-4"></i></button></a>
                </div>
                    <div class="d-flex flex-column justify-content-center">
                        
                        <button data-user-id="{{user.id}}" class="btn shadow-none" id="notification-button"><i class="bi bi-bell-fill text-white  fs-4"></i>
                        <span class="notification-badge">{{notification}}</span>
                    </button>
                        
                    </div>
                    <div id="notification-results" class="col-lg-4 col-11 rounded shadow-lg">
                        <!-- Results will be displayed here -->
                    </div>
                    <div class="border rounded p-2 pb-0 mt-2 ms-3">
                        <p class="text-light "><i class="bi bi-shield-fill"></i> {{user.club_name}} </p>
                    </div>
                    <a class="d-flex flex-column justify-content-center text-decoration-none"
                        href="{% url 'logout' %}"><button class="btn text-white ms-4">Log-out</button></a>
                </div>
            </div>
        </div>
    </nav>
    <div class="d-flex flex-wrap justify-content-center mt-4">
        <div class="col-lg-3 h-50 col-12 m-3 p-5 rounded bg-white shadow-lg position-sticky">
            <div class="">
                <div class="d-flex justify-content-center">
                    <div class="">
                        <img class="rounded-circle img-width " src={{user.img.url}} alt="">
                    </div>
                </div>
                <div class="text-center">
                    <p class="text-dark mt-2 fs-4 fw-bold">{{user.club_name}} {% if user.scouted_by != '' %}
                        <i class="bi bi-patch-check-fill text-primary"></i>
                        {% endif %}</p>
                    <p class="text-secondary">District: {{user.district}}</p>
                    <p class="text-secondary">Locality: {{user.locality}}</p>

                </div>
                <div>
                    <p>Club Reputation :{% with reputation=user.club_reputation %} {% for j in abilityRange %}
                        {% if j < reputation %}
                        <i class="bi bi-star-fill text-warning"></i>
                        {% else %}
                        <i class="bi bi-star text-warning"></i>
                        {% endif %}
                        {% endfor %}
                        {% endwith %}
                    </p>
                            {% if user.scouted_by != '' %}
                            <p class="fw-bold">Scouted By {{user.scouted_by}} <i class="bi bi-patch-check-fill text-primary"></i></p>
                            {% endif %}
                </div>
                
                <div class="d-flex justify-content-center"><a href="{% url 'EditClub' %}"><button
                            class="btn btn-outline-primary">Edit Profile</button></a></div>
            </div>
        </div>
        <div class="col-lg-5 col-12 player-feeds m-3 p-5 rounded bg-white shadow-lg">
            <div class="d-flex justify-content-evenly mb-3">
                <div class="text-center">
                    <p class="fs-4 fw-bold">{{post_count}}</p>
                    <p class="fs-5">Posts</p>
                </div>
                <a class="text-decoration-none text-dark" href="{% url 'follower' user.id %}">
                    <div class="text-center">
                        <p class="fs-4 fw-bold">{{followers}}</p>
                        <p class="fs-5">Followers</p>
                    </div>
                </a>
                <a class="text-decoration-none text-dark" href="{% url 'followingUsers' user.id %}">
                    <div class="text-center">
                        <p class="fs-4 fw-bold">{{following}}</p>
                        <p class="fs-5">Following</p>
                    </div>
                </a>
            </div>
            <div class="w-100 d-flex justify-content-center">
                <div class="w-100">
                    <form method="post">
                        {% csrf_token %}
                    <textarea class="form-control" required name="feed" id="" cols="30" rows="5"
                        placeholder="Share a post"></textarea>
                    <div class="d-flex justify-content-around m-2 mt-4">
                        
                        
                        <button type="submit" class="btn btn-outline-warning"><i class="bi bi-send-fill"></i> Post</button>
                    </div>
                    </form>
                    <div class="d-flex justify-content-evenly">
                        <a href="{% url 'PostImage' %}"><button class="btn btn-outline-primary"><i class="bi bi-image"></i> Photo</button></a>
                        <a href="{% url 'tour' %}"><button class="btn btn-outline-danger"><i class="bi bi-trophy-fill"></i> Tournaments</button></a>
                    <a href="{% url 'PostVideo' %}"><button class="btn btn-outline-success"><i class="bi bi-play-btn-fill"></i> Video</button></a>
                    </div>
                </div>
            </div>
            {% for i in newfeeds %}
            
            <div class="mt-4 border-top pt-4">
                <div class="d-flex">
                    <div class="feed-img">
                        <img class="w-100 rounded-circle" src={{user.img.url}} alt="">
                    </div>
                    <div class="ms-2 d-flex">
                        <p class="fw-bold">
                            {{user.club_name}}
                        </p>
                        <p class="ms-2 text-secondary">{{i.datetime}}</p>
                    </div>  
                </div>
                <div class="w-100 mt-3">
                    {% if i.video.url != '' %}
                    <video class="w-100" controls>
                        <source src="{{ i.video.url }}" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                    {% endif %}
                    {% if i.img.url != '' %}
                    <div class="w-100 mt-3">
                        <img class="w-100"
                            src="{{i.img}}"
                            alt="">
                    </div>
                    {% endif %}
                </div>
                
                <div class="mt-3">
                    <p class="fw-bold">{{user.club_name}}
                    <p>{{i.feed}}</p>
                    </p>
                    <div class="mt-2">
                        <button class="btn shadow-none like-button" data-feed-id="{{ i.id }}">
                            <i class="bi bi-heart fs-5"></i>
                        </button>
                        <a class="text-decoration-none text-dark" href="{% url 'likesUsers' i.id %}"><p id="likes-count-{{ i.id }}">{{ i.likes_cout }} likes</p></a>
                    </div>

                </div>
            </div>
            {% endfor %}
            <!-- {% for i in userimgfeeds %}
            <div class="mt-4 border-top pt-4">
                <div class="d-flex">
                    <div class="feed-img">
                        <img class="w-100 rounded-circle" src={{user.img.url}} alt="">
                    </div>
                    <div class="ms-2">
                        <p class="fw-bold">
                            {{user.club_name}}
                        </p>

                    </div>
                </div>
                <div class="w-100 mt-3">
                    <img class="w-100"
                        src="{{i.img}}"
                        alt="">
                </div>
                <div class="mt-3">
                    <p class="fw-bold">{{user.club_name}}
                    <p>{{i.feed}}</p>
                    </p>

                </div>
            </div>
            {% endfor %}
            {% for i in userfeeds %}
            <div class="mt-4 border-top pt-4">
                <div class="d-flex">
                    <div class="feed-img">
                        <img class="w-100 rounded-circle" src={{user.img.url}} alt="">
                    </div>
                    <div class="ms-2">
                        <p class="fw-bold">
                            {{user.club_name}}
                        </p>

                    </div>
                </div>
                <div class="mt-3">
                    
                    <p>{{i.feed}}</p>
                    </p>

                </div>
            </div>
            {% endfor %} -->
            


        </div>
        <div class="col-lg-3 col-12">
            <div class="m-3 player-recomendation p-5 rounded bg-white shadow-lg">
                <div>
                    <p class="fw-bold">Recommended Players</p>
                    {% for Players in playerdata %}

                    <a class="text-decoration-none text-dark" href="{% url 'player-home' Players.id %}">
                        <div class="d-flex">
                            <div class="rec-img-club">
                                <img class="w-100 rounded-circle" src="{{Players.img}}" alt="">
                            </div>
                            <p class="ms-2">{{Players.first_name}} {{Players.last_name}}{% if Players.scouted_by != '' %}
                                <i class="bi bi-patch-check-fill text-primary"></i>
                                {% endif %}</p></p>
                        </div>
                    </a>
                    {% endfor %}


                </div>
            </div>
            <div class="m-3 p-5 player-recomendation rounded bg-white shadow-lg">
                <div>
                    <p class="fw-bold">Recommended Scouts</p>
                    {% for scouts in scout %}
                    {% if scouts.is_staff == 0 %}
                    <a class="text-decoration-none text-dark" href="{% url 'scout-home' scouts.id %}">
                        <div class="d-flex">
                            <div class="rec-img-club">
                                <img class="w-100 rounded-circle" src="{{scouts.img}}" alt="">
                            </div>
                            <p class="ms-2">{{scouts.first_name}} {{scouts.last_name}} <i class="bi bi-patch-check-fill text-primary"></i></p>
                        </div>
                    </a>
                    {% endif %}
                    {% endfor %}

                </div>
            </div>
        </div>
    </div>
    {% elif user.is_scout %}
    <nav class="navbar player-navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="ms-5 navbar-brand d-flex fs-2 fw-bold" href="#">
                <p class="text-white">Urban</p>
                <p class="text-warning">Scout</p>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <div class="ms-3 d-flex w-75">
                    <input type="text" class="form-control" id="search_bar" placeholder="Search">
                    <button class="btn shadow-none"><i class="bi bi-search fs-3 text-white"></i></button>
                </div>
                <div id="search-results" class="col-lg-3 col-11 rounded shadow-lg">
                    <!-- Results will be displayed here -->
                </div>
                <div class="ms-3">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link  text-white" aria-current="page" href="{% url 'index' %}">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-secondary" aria-current="page" href="{% url 'ScoutClub' %}">Clubs</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-secondary" aria-current="page"
                                href="{% url 'ScoutPlayer' %}">Players</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-secondary" aria-current="page"
                                href="{% url 'following_feeds' %}">Feeds</a>
                        </li>
                    </ul>
                </div>
                <div class="d-flex w-100 justify-content-start justify-content-sm-end">
                    <div class="d-flex flex-column justify-content-center">
                    </div>
                    <div class="d-flex flex-column justify-content-center"><button data-user-id="{{user.id}}" class="btn shadow-none" id="notification-button"><i class="bi bi-bell-fill text-white  fs-4"></i>
                        <span class="notification-badge">{{notification}}</span>
                    </button>
                        
                    </div>
                    <div id="notification-results" class="col-lg-4 col-11 rounded shadow-lg">
                        <!-- Results will be displayed here -->
                    </div>
                    <div class="border rounded p-2 pb-0 mt-2 ms-3">
                        <p class="text-light "><i class="bi bi-binoculars-fill"></i> {{user.first_name}}</p>
                    </div>
                    <a class="d-flex flex-column justify-content-center text-decoration-none"
                        href="{% url 'logout' %}"><button class="btn text-white ms-4">Log-out</button></a>
                </div>
            </div>
        </div>
    </nav>
    
    <div class="d-flex flex-wrap justify-content-center mt-4">
        <div class="col-lg-3 player-profile h-50 col-12 m-3 p-5 rounded bg-white shadow-lg position-sticky">
            <div class="">
                <div class="d-flex justify-content-center">
                    <div class="">
                        <img class="rounded-circle img-width " src={{user.img.url}} alt="">
                    </div>
                </div>
                <div class="text-center">
                    <p class="text-dark mt-2 fs-4 fw-bold">{{user.first_name}} {{user.last_name}} <i class="bi bi-patch-check-fill text-primary"></i></p>
                    <p class="text-secondary">District: {{user.district}}</p>
                    <p class="text-secondary">Locality: {{user.locality}}</p>

                </div>
                <div>
                    <p class="fw-bold">UrbanScout Rating: <i class="bi bi-star-fill text-warning"></i><i
                            class="bi bi-star-fill text-warning"></i><i class="bi bi-star-fill text-warning"></i><i
                            class="bi bi-star-fill text-warning"></i><i class="bi bi-star-half text-warning"></i></p>
                </div>
                
            </div>
        </div>
        <div class="col-lg-5 col-12 player-feeds m-3 p-5 rounded bg-white shadow-lg">
            <div class="d-flex justify-content-evenly mb-3">
                <div class="text-center">
                    <p class="fs-4 fw-bold">{{post_count}}</p>
                    <p class="fs-5">Posts</p>
                </div>
                <a class="text-decoration-none text-dark" href="{% url 'follower' user.id %}">
                    <div class="text-center">
                        <p class="fs-4 fw-bold">{{followers}}</p>
                        <p class="fs-5">Followers</p>
                    </div>
                </a>
                <a class="text-decoration-none text-dark" href="{% url 'followingUsers' user.id %}">
                    <div class="text-center">
                        <p class="fs-4 fw-bold">{{following}}</p>
                        <p class="fs-5">Following</p>
                    </div>
                </a>
            </div>
            <div class="w-100 d-flex justify-content-center">
                
                <div class="w-100">
                    <form method="post">
                        {% csrf_token %}
                    <textarea class="form-control" required name="feed" id="" cols="30" rows="5"
                        placeholder="Share a post"></textarea>
                    <div class="d-flex justify-content-around m-2 mt-4">
                        
                        
                        <button type="submit" class="btn btn-outline-warning"><i class="bi bi-send-fill"></i> Post</button>
                    </div>
                    </form>
                    <div class="d-flex justify-content-evenly">
                        <a href="{% url 'PostImage' %}"><button class="btn btn-outline-primary"><i class="bi bi-image"></i> Photo</button></a>
                        <a href="{% url 'PostVideo' %}"><button class="btn btn-outline-success"><i class="bi bi-play-btn-fill"></i> Video</button></a>
                    </div>
                </div>
            </div>
            {% for i in newfeeds %}
            <div class="mt-4 border-top pt-4">
                <div class="d-flex">
                    <div class="feed-img">
                        <img class="w-100 rounded-circle" src={{user.img.url}} alt="">
                    </div>
                    <div class="ms-2 d-flex">
                        <p class="fw-bold">
                            {{user.first_name}} {{user.last_name}}
                        </p>
                        <p class="ms-2 text-secondary">{{i.datetime}}</p>
                    </div>
                </div>
                <div class="w-100 mt-3">
                    {% if i.video.url != '' %}
                    <video class="w-100" controls>
                        <source src="{{ i.video.url }}" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                    <p class="fw-bold mt-3">{{user.first_name}} {{user.last_name}}
                    {% endif %}
                    {% if i.img.url != '' %}
                    <div class="w-100 mt-3">
                        <img class="w-100"
                            src="{{i.img}}"
                            alt="">
                    </div>
                    <p class="mt-3 fw-bold">{{user.first_name}} {{user.last_name}}
                    {% endif %}
                </div>
                <div class="">
                    
                    <p>{{i.feed}}</p>
                    </p>
                    <div class="mt-2">
                        <button class="btn shadow-none like-button" data-feed-id="{{ i.id }}">
                            <i class="bi bi-heart fs-5"></i>
                        </button>
                        <a class="text-decoration-none text-dark" href="{% url 'likesUsers' i.id %}"><p id="likes-count-{{ i.id }}">{{ i.likes_cout }} likes</p></a>
                    </div>

                </div>
            </div>
            {% endfor %}
            <!-- <div class="mt-4 border-top pt-4">
                <div class="d-flex">
                    <div class="feed-img">
                        <img class="w-100 rounded-circle" src={{user.img.url}} alt="">
                    </div>
                    <div class="ms-2">
                        <p class="fw-bold">
                            {{user.first_name}} {{user.last_name}}
                        </p>

                    </div>
                </div>
                <div class="w-100 mt-3">
                    <img class="w-100"
                        src="https://images.unsplash.com/photo-1589487391730-58f20eb2c308?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxleHBsb3JlLWZlZWR8Nnx8fGVufDB8fHx8fA%3D%3D&w=1000&q=80"
                        alt="">
                </div>
                <div class="mt-3">
                    <p class="fw-bold">{{user.first_name}} {{user.last_name}}
                    <p>Retail giants like Reliance Retail, Aditya Birla Fashion & Retail, and Devyani International,
                        among others, are on an offline expansion spree, but real estate is proving hard to come by,
                        reports Livemint.</p>
                    </p>

                </div>
            </div> -->


        </div>
        <div class="col-lg-3 col-12">
            <div class="m-3 p-5 player-recomendation rounded bg-white shadow-lg">
                <div>
                    <p class="fw-bold">Recommended Players</p>
                    {% for Players in playerdata %}

                    <a class="text-decoration-none text-dark" href="{% url 'player-home' Players.id %}">
                        <div class="d-flex">
                            <div class="rec-img-club">
                                <img class="w-100 rounded-circle" src="{{Players.img}}" alt="">
                            </div>
                            <p class="ms-2">{{Players.first_name}} {{Players.last_name}}{% if Players.scouted_by != '' %}
                                <i class="bi bi-patch-check-fill text-primary"></i>
                                {% endif %}</p></p>
                        </div>
                    </a>
                    {% endfor %}


                </div>
            </div>
            <div class="m-3 p-5 player-recomendation rounded bg-white shadow-lg">
                <div>
                    <p class="fw-bold">Recommended Clubs</p>
                    {% for clubs in clubdata %}
                    <a class="text-decoration-none text-dark" href="{% url 'clubHome' clubs.id %}">
                    <div class="d-flex">
                        <div class="rec-img-club">
                            <img class="w-100 rounded-circle" src="{{clubs.img}}" alt="">
                        </div>
                        <p class="ms-2">{{clubs.club_name}} {% if clubs.scouted_by != '' %}
                            <i class="bi bi-patch-check-fill text-primary"></i>
                            {% endif %}</p></p></p>
                    </div>
                    </a>
                    {% endfor %}


                </div>
            </div>
            
        </div>
    </div>
    {% elif user.is_player %}
    <nav class="navbar player-navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="ms-5 navbar-brand d-flex fs-2 fw-bold" href="#">
                <p class="text-white">Urban</p>
                <p class="text-warning">Scout</p>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <div class="ms-3 d-flex w-75">
                    <input type="text" class="form-control" id="search_bar" placeholder="Search">
                    <button class="btn shadow-none"><i class="bi bi-search fs-3 text-white"></i></button>
                </div>
                <div id="search-results" class="col-lg-3 col-11 rounded shadow-lg">
                    <!-- Results will be displayed here -->
                </div>
                <div class="ms-3">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link  text-white" aria-current="page" href="{% url 'index' %}">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-secondary" aria-current="page"
                                href="{% url 'PlayerScout' %}">Scouts</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-secondary" aria-current="page"
                                href="{% url 'player-club' %}">Clubs</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-secondary" aria-current="page"
                                href="{% url 'following_feeds' %}">Feeds</a>
                        </li>

                    </ul>
                </div>
                
                <div class="d-flex w-100 justify-content-start justify-content-sm-end">
                    <div class="d-flex flex-column justify-content-center">
                    </div>
                    <div class="d-flex flex-column justify-content-center"><button data-user-id="{{user.id}}" class="btn shadow-none" id="notification-button"><i class="bi bi-bell-fill text-white  fs-4"></i>
                        <span class="notification-badge">{{notification}}</span>
                    </button>
                        
                    </div>
                    <div id="notification-results" class="col-lg-4 col-11 rounded shadow-lg">
                        <!-- Results will be displayed here -->
                    </div>
                    
                    <div class="border rounded p-2 pb-0 mt-2 ms-3">
                        <p class="text-light "><i class="bi bi-person-circle"></i> {{user.first_name}}</p>
                    </div>
                    <a class="d-flex flex-column justify-content-center text-decoration-none"
                        href="{% url 'logout' %}"><button class="btn text-white ms-4">Log-out</button></a>
                </div>
            </div>
        </div>
    </nav>
    <div class="d-flex flex-wrap justify-content-center mt-4">
        <div class="col-lg-3 h-50 col-12 m-3 p-5 rounded bg-white shadow-lg position-sticky">
            <div class="">
                <div class="d-flex justify-content-center">
                    <div class="">
                        <img class="rounded-circle img-width" src={{user.img.url}} alt="Player">
                    </div>
                </div>
                <div class="text-center">
                    <p class="text-dark mt-2 fs-4 fw-bold">{{user.first_name}} {{user.last_name}} {% if user.scouted_by != '' %}
                        <i class="bi bi-patch-check-fill text-primary"></i>
                        {% endif %}</p>
                    <p id="age" class="text-secondary"></p>
                    <script>
                        var playerDobString = "{{ user.player_dob }}";
                        console.log(playerDobString);

                        var dobParts;
                        var year, month, day;

                        if (playerDobString.includes(',')) {
                            // Format: Oct. 17, 2001
                            var months = {
                                'Jan.': 0, 'Feb.': 1, 'March': 2, 'Apr.': 3, 'May': 4, 'June': 5,
                                'Jul.': 6, 'Aug.': 7, 'Sept.': 8, 'Oct.': 9, 'Nov.': 10, 'Dec.': 11
                            };

                            dobParts = playerDobString.split(' ');
                            month = months[dobParts[0]];
                            day = parseInt(dobParts[1].replace(',', ''));
                            year = parseInt(dobParts[2]);
                        } else {
                            // Format: 2001-10-17
                            dobParts = playerDobString.split('-');
                            year = parseInt(dobParts[0]);
                            month = parseInt(dobParts[1]) - 1; // Months are 0-indexed in JavaScript
                            day = parseInt(dobParts[2]);
                        }

                        // Create a Date object from the parsed parts
                        var playerDate = new Date(year, month, day);
                        console.log(playerDate)
                        // Calculate the age based on player's date of birth
                        var today = new Date();
                        var age = today.getFullYear() - playerDate.getFullYear() - (today.getMonth() < playerDate.getMonth() || (today.getMonth() === playerDate.getMonth() && today.getDate() < playerDate.getDate()) ? 1 : 0);

                        // You can now use the 'age' variable for your JavaScript logic
                        console.log("Player's age is: " + age);
                        document.getElementById("age").textContent = "Age: " + age;
                    </script>


                    <p class="text-secondary">Position: {{user.player_pos}}</p>
                    <p class="text-secondary">District: {{user.district}}</p>
                    <p class="text-secondary">Locality: {{user.locality}}</p>
                </div>
                <div>
                    <p>Ability:{% with ability=user.player_ability %} {% for i in abilityRange %}
                        {% if i < ability %}
                        <i class="bi bi-star-fill text-warning"></i>
                        {% else %}
                        <i class="bi bi-star text-warning"></i>
                        {% endif %}
                        {% endfor %}
                        {% endwith %}
                    </p>
                    <p>Potential:{% with potential=user.player_potential %} {% for i in abilityRange %}
                        {% if i < potential %}
                        <i class="bi bi-star-fill text-warning"></i>
                        {% else %}
                        <i class="bi bi-star text-warning"></i>
                        {% endif %}
                        {% endfor %}
                        {% endwith %}
                    </p>
                    {% if user.scouted_by != '' %}
                    <p class="fw-bold">Scouted By {{user.scouted_by}} <i class="bi bi-patch-check-fill text-primary"></i></p>
                    {% endif %}
                </div>
                <div class="d-flex justify-content-center"><a href="{% url 'edit-player-profile' %}"><button
                            class="btn btn-outline-info">Edit Profile</button></a></div>
            </div>
        </div>
        <div class="col-lg-5 col-12 player-feeds m-3 p-5 rounded bg-white shadow-lg">
            <div class="d-flex justify-content-evenly mb-3">
                <div class="text-center">
                    <p class="fs-4 fw-bold">{{post_count}}</p>
                    <p class="fs-5">Posts</p>
                </div>
                <a class="text-decoration-none text-dark" href="{% url 'follower' user.id %}">
                    <div class="text-center">
                        <p class="fs-4 fw-bold">{{followers}}</p>
                        <p class="fs-5">Followers</p>
                    </div>
                </a>
                <a class="text-decoration-none text-dark" href="{% url 'followingUsers' user.id %}">
                    <div class="text-center">
                        <p class="fs-4 fw-bold">{{following}}</p>
                        <p class="fs-5">Following</p>
                    </div>
                </a>
            </div>
            <div class="w-100 d-flex justify-content-center">
                <div class="w-100">
                    <form method="post">
                        {% csrf_token %}
                    <textarea class="form-control" required name="feed" id="" cols="30" rows="5"
                        placeholder="Share a post"></textarea>
                    <div class="d-flex justify-content-around m-2 mt-4">
                        
                        
                        <button type="submit" class="btn btn-outline-warning"><i class="bi bi-send-fill"></i> Post</button>
                    </div>
                    </form>
                    <div class="d-flex justify-content-evenly">
                        <a href="{% url 'PostImage' %}"><button class="btn btn-outline-primary"><i class="bi bi-image"></i> Photo</button></a>
                        <a href="{% url 'PostVideo' %}"><button class="btn btn-outline-success"><i class="bi bi-play-btn-fill"></i> Video</button></a>
                    </div>
                </div>
            </div>
            {% for i in newfeeds %}
            <div class="mt-4 border-top pt-4">
                <div class="d-flex">
                    <div class="feed-img">
                        <img class="w-100 rounded-circle" src={{user.img.url}} alt="">
                    </div>
                    <div class="ms-2 d-flex">
                        <p class="fw-bold">
                            {{user.first_name}} {{user.last_name}}
                        </p>
                        <p class="ms-2 text-secondary">{{i.datetime}}</p>

                    </div>
                </div>
                <div class="w-100 mt-3" >
                    {% if i.video.url != '' %}
                    <video class="w-100" controls>
                        <source src="{{ i.video.url }}" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                    <p class="fw-bold mt-3">{{user.first_name}} {{user.last_name}}
                    {% endif %}
                    {% if i.img.url != '' %}
                    <div class="w-100 mt-3">
                        <img class="w-100"
                            src="{{i.img}}"
                            alt="">
                    </div>
                    
                    <p class="mt-3 fw-bold">{{user.first_name}} {{user.last_name}}
                    {% endif %}
                </div>
                
                
                <div class="">
                    
                    <p>{{i.feed}}</p>
                    </p>
                    <div class="mt-2">
                        <button class="btn shadow-none like-button" data-feed-id="{{ i.id }}">
                            <i class="bi bi-heart fs-5"></i>
                        </button>
                        <a class="text-decoration-none text-dark" href="{% url 'likesUsers' i.id %}"><p id="likes-count-{{ i.id }}">{{ i.likes_cout }} likes</p></a>
                    </div>
                    
                </div>
            </div>
            {% endfor %}
            


        </div>
        <div class="col-lg-3 col-12">
            <div class="m-3 p-5 rounded player-recomendation bg-white shadow-lg">
                <div>
                    <p class="fw-bold">Recommended Clubs</p>
                    {% for clubs in clubdata %}

                    <a class="text-decoration-none text-dark" href="{% url 'clubHome' clubs.id %}">
                        <div class="d-flex">
                            <div class="rec-img-club">
                                <img class="w-100 rounded-circle" src="{{clubs.img.url}}" alt="">
                            </div>
                            <p class="ms-2">{{clubs.club_name}}{% if clubs.scouted_by != ''%}
                                <i class="bi bi-patch-check-fill text-primary"></i>
                                {% endif %}
                            </p>
                            </p>
                        </div>
                    </a>
                    {% endfor %}


                </div>
            </div>
            <div class="m-3 p-5 player-recomendation rounded bg-white shadow-lg">
                <div>
                    <p class="fw-bold">Recommended Scouts</p>
                    {% for scouts in scout %}
                    {% if scouts.is_staff == 0 %}
                    <a class="text-decoration-none text-dark" href="{% url 'scout-home' scouts.id %}">
                        <div class="d-flex">
                            <div class="rec-img-club">
                                <img class="w-100 rounded-circle" src="{{scouts.img.url}}" alt="">
                            </div>
                            <p class="ms-2">{{scouts.first_name}} {{scouts.last_name}} <i
                                    class="bi bi-patch-check-fill text-primary"></i></p>
                        </div>
                    </a>
                    {% endif %}
                    {% endfor %}

                </div>
            </div>
        </div>
    </div>
    {% elif user.is_authenticated %}
    <div class="d-flex justify-content-center vh-100 align-items-center">
        <div class="col-lg-5 col-12 text-center">
            <h1>Select user type</h1>
            <div class="d-flex d-flex justify-content-evenly mt-5">
                <a href="{% url 'player-selected' %}">
                    <button class="p-5 btn btn-outline-primary">
                        <i class="bi bi-person-fill fs-1"></i>
                        <p>Player</p>
                    </button>
                </a>
                <a href="{% url 'club-selected' %}">
                    <button class="p-5 btn btn-outline-primary">
                        <i class="bi bi-shield-fill fs-1"></i>
                        <p>Club</p>
                    </button>
                </a>
            </div>
        </div>
    </div>
    {% else %}
    <div class="hero">
        <div class="overlay text-center p-5 d-flex flex-column justify-content-center">
            <p class="h1 text-white fw-bold">UrbanScout</p>
            <p class="h5 text-secondary mt-3">"Unleash Urban Football Excellence with UrbanScout! Discover the Rising
                Stars of the City Streets. Join our Dynamic Football Community, where Players, Scouts, and Clubs Unite
                to Ignite the Passion for the Game. Embrace Talent, Empower Dreams, and Redefine Football Scouting in
                Urban Landscapes. Step into the World of UrbanScout – Where Talent Meets Opportunity!"</p>
            <div class="d-flex justify-content-center">
                <a href="{% url 'login' %}">
                    <button class="button mt-5">
                        <span class="button-content">Log-in</span>
                    </button>
                </a>
            </div>
        </div>
    </div>
    {% endif %}
</body>

</html>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    $(document).ready(function () {
        
        $(".like-button").each(function () {
            var feedId = $(this).data("feed-id");
            var likeButton = $(this);
            var headers = {
                "X-CSRFToken": $("input[name=csrfmiddlewaretoken]").val()
            };
            // Check if the user has already liked the feed
            $.ajax({
                type: "GET",
                headers: headers,
                url: "{% url 'check_like_status' 0 %}".replace('0', feedId),
                success: function (data) {
                    if (data.liked) {
                        // User has already liked the feed, display the liked icon
                        likeButton.html('<i class="bi bi-heart-fill fs-5 text-danger"></i>');
                    } else {
                        // User has not liked the feed, display the regular like icon
                        likeButton.html('<i class="bi bi-heart fs-5"></i>');
                    }
                },
                error: function (xhr, status, error) {
                    console.error(xhr.responseText);
                }
            });
        });

        // Handle like button click event
        $(".like-button").click(function () {
            var feedId = $(this).data("feed-id");
            var likeButton = $(this);
            var headers = {
                "X-CSRFToken": $("input[name=csrfmiddlewaretoken]").val()
            };
            $.ajax({
                type: "POST",
                headers: headers,
                url: "{% url 'like_feed_ajax' 0 %}".replace('0', feedId),
                success: function (data) {
                    // Update the like count on the page
                    $("#likes-count-" + feedId).text(data.likes_count+" likes");

                    // Toggle between the two icons
                    if (likeButton.html().includes("text-danger")) {
                        likeButton.html('<i class="bi bi-heart fs-5"></i>');
                    } else {
                        likeButton.html('<i class="bi bi-heart-fill fs-5 text-danger"></i>');
                    }
                },
                error: function (xhr, status, error) {
                    console.error(xhr.responseText);
                }
            });
        });
        $("#search_bar").keyup(function(){
            
            var headers = {
                "X-CSRFToken": $("input[name=csrfmiddlewaretoken]").val()
            };
            var searchTerm = $(this).val();
            console.log(searchTerm)
            if (searchTerm.trim() === "") {
        // If it's empty, hide the container and return
        $("#search-results").hide();
        return;
    }
    
            $.ajax({
                type:"GET",
                headers: headers,
                dataType:'Json',
                url:"{% url 'search_by_name' 0 %}".replace('0',searchTerm),
                success: function (data) {
                    // Clear previous results
                    $("#search-results").empty();

                    // Parse the JSON data
                    var users = JSON.parse(data);
                    
                    // Loop through the users and create HTML elements
                    for (var i = 0; i < users.length; i++) {
                        
    var user = users[i];
    console.log(user.pk)
    var userHtml = '<div class="user-box">';
    userHtml += '<img class="user-img" src="' + user.fields.img + '" alt="User Image">';
    userHtml += '<p class="user-name">';
    
    // Check if the user is a Scout and add a link to ScoutHome
    if (user.fields.is_scout) {
        userHtml += '<a class="text-decoration-none text-dark" href="{% url "scout-home" 0 %}">'.replace("0",user.pk);
        userHtml += user.fields.first_name + ' ' + user.fields.last_name;
    }
    // Check if the user is a Player and add a link to PlayerHome
    else if (user.fields.is_player) {
        userHtml += '<a class="text-decoration-none text-dark" href="{% url "player-home" 0 %}">'.replace("0",user.pk);
        userHtml += user.fields.first_name + ' ' + user.fields.last_name;
    }
    else{
        userHtml += '<a class="text-decoration-none text-dark" href="{% url "clubHome" 0 %}">'.replace("0",user.pk);
        userHtml += user.fields.club_name;
    }
    
    // Close the anchor tag if added
    if (user.fields.isScout || user.fields.isPlayer) {
        userHtml += '</a>';
    }
    
    userHtml += '</p>';
    userHtml += '</div>';

    $("#search-results").append(userHtml);
}

                    
                    // Show the user list
                    $("#search-results").show();
                },
                error: function (xhr, status, error) {
                    console.error(xhr.responseText);
                }
            })
        })
        // Initialize a flag to track the visibility state
var isResultsVisible = false;


$("#notification-button").click(function () {
    // Toggle the flag
    isResultsVisible = !isResultsVisible;

    if (isResultsVisible) {
        $("#notification-results").empty();
        var user_id = $(this).data("user-id");
        console.log(user_id);
        $.ajax({
            type: "GET",
            dataType: "json",
            url: "{% url 'notificationUsers' 0 %}".replace('0', user_id),
            success: function (data) {
                console.log(data);
                var users = JSON.parse(data);
                for (var i = 0; i < users.length; i++) {

                    var user = users[0];
                    
                    var userHtml = '<div class="user-box">';
                    userHtml += '<img class="user-img" src="' + user.fields.img + '" alt="User Image">';
                    userHtml += '<p class="user-name">';

                    // Check if the user is a Scout and add a link to ScoutHome
                    if (user.fields.is_scout) {
                        userHtml += '<a class="text-decoration-none text-dark" href="{% url "scout-home" 0 %}'.replace("0", user.pk) + '">';
                        userHtml += user.fields.first_name + ' ' + user.fields.last_name;
                    }
                    // Check if the user is a Player and add a link to PlayerHome
                    else if (user.fields.is_player) {
                        userHtml += '<a class="text-decoration-none text-dark" href="{% url "player-home" 0 %}'.replace("0", user.pk) + '">';
                        userHtml += user.fields.first_name + ' ' + user.fields.last_name;
                    } else {
                        userHtml += '<a class="text-decoration-none text-dark" href="{% url "clubHome" 0 %}'.replace("0", user.pk) + '">';
                        userHtml += user.fields.club_name;
                    }
                    userHtml += '<p class="ms-1 col-5">has started following you</p>';
                    
                    // Close the anchor tag if added
                    userHtml += '</a>';

                    userHtml += '</p>';
                    userHtml += '<div class="d-flex col-2 justify-content-end"><button data-user-id1="'+ user.pk +'" id="notification_marked" class="btn btn-primary"><i class="bi bi-bookmark-check-fill"></i></button></div>';
                    userHtml += '</div>';

                    $("#notification-results").append(userHtml);
                }

                // Show the user list
                $("#notification-results").show();
            },
            error: function (xhr, status, error) {
                console.error(xhr.responseText);
            }
        });
    } else {
        // Hide the user list
        $("#notification-results").hide();
    }
});
$("#notification-results").on("click", "#notification_marked", function () {
        console.log("hello");
        var user_id = $(this).data("user-id1");
        var headers = {
                "X-CSRFToken": $("input[name=csrfmiddlewaretoken]").val()
            };
        console.log(user_id);
        $.ajax({
            type:"POST",
            headers: headers,
            url:"{% url 'deleteNotification' 0 %}".replace("0",user_id),
            success: function (data) {
                console.log(data)
                if(data["message"]=="success"){
                    $("#notification_marked").html('<i class="bi bi-check2-all text-info"></i>').prop("disabled", true).removeClass("btn btn-primary").addClass("btn shadow-none") ;
                    $(".notification-badge").html(data["notification_count"]);
                }

            }
        })
    });


    });

</script>
